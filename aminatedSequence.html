<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Animated Sequence</title>
  <style>
    html, body {
      height: 200%;
      margin: 0;
      padding: 0;
      background: #000;
    }
    #animatedImage {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      object-fit: cover;
      object-position: center center;
    }
  </style>
</head>
<body>
  <img id="animatedImage" src="" alt="Animated Sequence">
  <script>
    const html = document.documentElement;
    const img = document.getElementById("animatedImage");

    const frameCount = 121; 
    const currentFrame = index => (`https://raw.githubusercontent.com/kdoguserkan/tinies/main/${(index).toString().padStart(4, '0')}.png`);

    const preloadImages = () => {
      for (let i = 1; i <= frameCount; i += 2) { 
        const preloadedImg = new Image();
        preloadedImg.src = currentFrame(i);
      }
    };

    const preloadNearbyImages = (currentIndex) => {
      const preloadRange = 3;  
      for (let i = currentIndex + 2; i <= Math.min(currentIndex + 2 * preloadRange, frameCount); i += 2) { 
        const img = new Image();
        img.src = currentFrame(i);
      }
    };

    img.src = currentFrame(1);

    const updateImage = index => {
      img.src = currentFrame(index * 2 - 1); 
    };

    let lastExecution = Date.now();
    const throttleDuration = 100;  

    window.addEventListener('scroll', () => {
      if (Date.now() - lastExecution > throttleDuration) {
        const scrollTop = html.scrollTop;
        const maxScrollTop = html.scrollHeight - window.innerHeight;
        const scrollFraction = scrollTop / maxScrollTop;
        const frameIndex = Math.min(
          frameCount - 1,
          Math.ceil(scrollFraction * frameCount / 2) 
        );

        requestAnimationFrame(() => {
          updateImage(frameIndex + 1); 
          preloadNearbyImages(frameIndex);  
        });

        lastExecution = Date.now();
      }
    });

    preloadImages();
  </script>
</body>
</html>
